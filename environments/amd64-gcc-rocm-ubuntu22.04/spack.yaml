spack:
  view: false

  compilers:
  - compiler:
      spec: gcc@=11.4.0
      paths:
        cc: /usr/bin/gcc
        cxx: /usr/bin/g++
        f77: /usr/bin/gfortran
        fc: /usr/bin/gfortran
      flags: {}
      operating_system: ubuntu22.04
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []

  concretizer:
    reuse: false
    unify: false

  packages:
    all:
      target: [x86_64_v3]
      require:
      - '@:99999999'
      - 'target=x86_64_v3'
      - '%gcc@11.4.0'
      providers:
        blas: [openblas]
        lapack: [openblas]
        tbb: [intel-tbb]
      variants: +mpi
    binutils:
      variants: +ld +gold +headers +libiberty ~nls
    blas:
      require: openblas
    cmake:
      require:
      - '~qtgui'
      - 'target=x86_64_v3'
      - '%gcc@11.4.0'
    gmake:
      require:
      - '~guile'
      - 'target=x86_64_v3'
      - '%gcc@11.4.0'
    hdf5:
      variants: +fortran +hl +shared
    lapack:
      require: openblas
    libfabric:
      variants: fabrics=sockets,tcp,udp,rxm
    libunwind:
      variants: +pic +xz
    openblas:
      variants: threads=openmp
    paraview:
      variants: +qt +examples
    qt:
      require: 
      - '@5.15.16'
      - 'target=x86_64_v3'
      - '%gcc@11.4.0'
    raja:
      variants: +plugins
    tbb:
      require: intel-tbb
    trilinos:
      variants: +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext
        +ifpack +ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu
        +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu +stokhos +stratimikos
        +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long
    vtk-m:
      require:
      - '+examples'
      - 'target=x86_64_v3'
      - '%gcc@11.4.0'
  
    # externals
    python:
      prefer:
      - "@3.10.12"
      externals:
      - spec: python@3.10.12+bz2+crypt+ctypes+dbm+lzma+pyexpat+pythoncmd+readline+sqlite3+ssl~tkinter+uuid+zlib
        prefix: /usr
    mpi:
      require: mpich
    mpich:
      buildable: false
      externals:
      - spec: 'mpich@4.2.3 ~argobots~cuda+fortran~hwloc+hydra+libxml2+pci~rocm+romio~slurm~vci~verbs~wrapperrpath~xpmem build_system=autotools datatype-engine=auto device=ch4 netmod=ofi pmi=default target=x86_64_v3'
        prefix: /usr/local/mpich/install/mpich
    comgr:
      buildable: false
      externals:
      - spec: comgr@6.3.2
        prefix: /opt/rocm-6.3.3/
    hip-rocclr:
      buildable: false
      externals:
      - spec: hip-rocclr@6.3.2
        prefix: /opt/rocm-6.3.3/hip
    hipblas:
      buildable: false
      externals:
      - spec: hipblas@6.3.2
        prefix: /opt/rocm-6.3.3/
    hipcub:
      buildable: false
      externals:
      - spec: hipcub@6.3.2
        prefix: /opt/rocm-6.3.3/
    hipfft:
      buildable: false
      externals:
      - spec: hipfft@6.3.2
        prefix: /opt/rocm-6.3.3/
    hipsparse:
      buildable: false
      externals:
      - spec: hipsparse@6.3.2
        prefix: /opt/rocm-6.3.3/
    miopen-hip:
      buildable: false
      externals:
      - spec: miopen-hip@6.3.2
        prefix: /opt/rocm-6.3.3/
    miopengemm:
      buildable: false
      externals:
      - spec: miopengemm@6.3.2
        prefix: /opt/rocm-6.3.3/
    rccl:
      buildable: false
      externals:
      - spec: rccl@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocblas:
      buildable: false
      externals:
      - spec: rocblas@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocfft:
      buildable: false
      externals:
      - spec: rocfft@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-clang-ocl:
      buildable: false
      externals:
      - spec: rocm-clang-ocl@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-cmake:
      buildable: false
      externals:
      - spec: rocm-cmake@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-dbgapi:
      buildable: false
      externals:
      - spec: rocm-dbgapi@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-debug-agent:
      buildable: false
      externals:
      - spec: rocm-debug-agent@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-device-libs:
      buildable: false
      externals:
      - spec: rocm-device-libs@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-gdb:
      buildable: false
      externals:
      - spec: rocm-gdb@6.3.2
        prefix: /opt/rocm-6.3.3/
    rocm-opencl:
      buildable: false
      externals:
      - spec: rocm-opencl@6.3.2
        prefix: /opt/rocm-6.3.3/opencl
    rocm-smi-lib:
      buildable: false
      externals:
      - spec: rocm-smi-lib@6.3.2
        prefix: /opt/rocm-6.3.3/
    hip:
      buildable: false
      externals:
      - spec: hip@6.3.2
        prefix: /opt/rocm-6.3.3
        extra_attributes:
          compilers:
            c: /opt/rocm-6.3.3/llvm/bin/clang++
            c++: /opt/rocm-6.3.3/llvm/bin/clang++
            hip: /opt/rocm-6.3.3/hip/bin/hipcc
    hipify-clang:
      buildable: false
      externals:
      - spec: hipify-clang@6.3.2
        prefix: /opt/rocm-6.3.3
    llvm-amdgpu:
      buildable: false
      externals:
      - spec: llvm-amdgpu@6.3.2
        prefix: /opt/rocm-6.3.3/llvm
        extra_attributes:
          compilers:
            c: /opt/rocm-6.3.3/llvm/bin/clang++
            cxx: /opt/rocm-6.3.3/llvm/bin/clang++
    hsakmt-roct:
      buildable: false
      externals:
      - spec: hsakmt-roct@6.3.2
        prefix: /opt/rocm-6.3.3/
    hsa-rocr-dev:
      buildable: false
      externals:
      - spec: hsa-rocr-dev@6.3.2
        prefix: /opt/rocm-6.3.3/
        extra_atributes:
          compilers:
            c: /opt/rocm-6.3.3/llvm/bin/clang++
            cxx: /opt/rocm-6.3.3/llvm/bin/clang++
    roctracer-dev-api:
      buildable: false
      externals:
      - spec: roctracer-dev-api@6.3.2
        prefix: /opt/rocm-6.3.3
    roctracer-dev:
      buildable: false
      externals:
      - spec: roctracer-dev@6.3.2
        prefix: /opt/rocm-6.3.3
    rocprim:
      buildable: false
      externals:
      - spec: rocprim@6.3.2
        prefix: /opt/rocm-6.3.3
    rocrand:
      buildable: false
      externals:
      - spec: rocrand@6.3.2
        prefix: /opt/rocm-6.3.3
    hipsolver:
      buildable: false
      externals:
      - spec: hipsolver@6.3.2
        prefix: /opt/rocm-6.3.3
    rocsolver:
      buildable: false
      externals:
      - spec: rocsolver@6.3.2
        prefix: /opt/rocm-6.3.3
    rocsparse:
      buildable: false
      externals:
      - spec: rocsparse@6.3.2
        prefix: /opt/rocm-6.3.3
    rocthrust:
      buildable: false
      externals:
      - spec: rocthrust@6.3.2
        prefix: /opt/rocm-6.3.3
    rocprofiler-dev:
      buildable: false
      externals:
      - spec: rocprofiler-dev@6.3.2
        prefix: /opt/rocm-6.3.3
    rocprofiler-sdk:
      buildable: false
      externals:
      - spec: rocprofiler-sdk@6.3.2
        prefix: /opt/rocm-6.3.3
    rocm-core:
      buildable: false
      externals:
      - spec: rocm-core@6.3.2
        prefix: /opt/rocm-6.3.3
    rocm-openmp-extras:
      buildable: false
      externals:
      - spec: rocm-openmp-extras@6.3.2
        prefix: /opt/rocm-6.3.3
  
  specs:
  - hpctoolkit +rocm
  - tau@2.34.1 +mpi +rocm +rocprofiler-sdk +syscall +ompt

  - amrex +rocm amdgpu_target=gfx908
  - arborx +rocm amdgpu_target=gfx908
  - cabana +rocm amdgpu_target=gfx908 ^kokkos +rocm amdgpu_target=gfx908
  - caliper +rocm amdgpu_target=gfx908
  - chai tests=none +rocm amdgpu_target=gfx908
  - chapel +rocm amdgpu_target=gfx908
  - fftx +rocm amdgpu_target=gfx908
  - gasnet +rocm amdgpu_target=gfx908
  - ginkgo +rocm amdgpu_target=gfx908
  - heffte +rocm amdgpu_target=gfx908
  - hpx +rocm amdgpu_target=gfx908
  - hypre +rocm amdgpu_target=gfx908
  - kokkos +rocm amdgpu_target=gfx908
  - legion +rocm amdgpu_target=gfx908
  - libceed +rocm amdgpu_target=gfx908
  - mfem +rocm amdgpu_target=gfx908
  - petsc +rocm amdgpu_target=gfx908
  - raja ~openmp +rocm amdgpu_target=gfx908
  - slate +rocm amdgpu_target=gfx908
  - slepc +rocm amdgpu_target=gfx908 ^petsc +rocm amdgpu_target=gfx908
  - strumpack ~slate +rocm amdgpu_target=gfx908
  - sundials +rocm amdgpu_target=gfx908
  - superlu-dist +rocm amdgpu_target=gfx908
  - tasmanian ~openmp +rocm amdgpu_target=gfx908
  - trilinos +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext +ifpack ~ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu ~stokhos +stratimikos +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long +rocm amdgpu_target=gfx908
  - umpire +rocm amdgpu_target=gfx908
  - upcxx +rocm amdgpu_target=gfx908
  # INCLUDED IN ECP DAV ROCM
  - paraview ~examples ~qt +rocm amdgpu_target=gfx908 ^llvm~lldb~lld~libomptarget~polly~gold libunwind=none compiler-rt=none # builds ok, installed w/ ecp-dav
  - vtk-m ~openmp +rocm amdgpu_target=gfx908 # builds ok, installed w/ ecp-dav
  # -- 
  # - cp2k +mpi +rocm amdgpu_target=gfx908    # cp2k-2025.1: https://github.com/spack/spack/issues/49544
  # - exago +mpi +python +raja +hiop +rocm amdgpu_target=gfx908 ~ipopt cxxflags="-Wno-error=non-pod-varargs" ^hiop@1.0.0 ~sparse +mpi +raja +rocm amdgpu_target=gfx908  # hiop-1.0.0: hiopVectorHip.hpp:68:10: fatal error: 'hipblas.h' file not found  
  # - lbann ~cuda +rocm amdgpu_target=gfx908  # aluminum-1.4.1: Could not find a configuration file for package "hip" that is compatible with requested version "5.0".
  # - magma ~cuda +rocm amdgpu_target=gfx908  # magma-2.9.0: KeyError: 'No spec with name rocm-core in magma@2.9.0/sn7z3duxlwsf6u47ysy253vlsrrhauu4'
  # - papi +rocm amdgpu_target=gfx908         # rocm-openmp-extras-6.2.1: Error: FileExistsError: [Errno 17] File exists: 


  - amrex +rocm amdgpu_target=gfx90a
  - arborx +rocm amdgpu_target=gfx90a
  - cabana +rocm amdgpu_target=gfx90a ^kokkos +rocm amdgpu_target=gfx90a
  - caliper +rocm amdgpu_target=gfx90a
  - chai tests=none +rocm amdgpu_target=gfx90a
  - chapel +rocm amdgpu_target=gfx90a
  - fftx +rocm amdgpu_target=gfx90a
  - gasnet +rocm amdgpu_target=gfx90a
  - ginkgo +rocm amdgpu_target=gfx90a
  - heffte +rocm amdgpu_target=gfx90a
  - hpx +rocm amdgpu_target=gfx90a
  - hypre +rocm amdgpu_target=gfx90a
  - kokkos +rocm amdgpu_target=gfx90a
  - legion +rocm amdgpu_target=gfx90a
  - libceed +rocm amdgpu_target=gfx90a
  - mfem +rocm amdgpu_target=gfx90a
  - petsc +rocm amdgpu_target=gfx90a
  - raja ~openmp +rocm amdgpu_target=gfx90a
  - slate +rocm amdgpu_target=gfx90a
  - slepc +rocm amdgpu_target=gfx90a ^petsc +rocm amdgpu_target=gfx90a
  - strumpack ~slate +rocm amdgpu_target=gfx90a
  - sundials +rocm amdgpu_target=gfx90a
  - superlu-dist +rocm amdgpu_target=gfx90a
  - tasmanian ~openmp +rocm amdgpu_target=gfx90a
  - trilinos +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext +ifpack ~ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu ~stokhos +stratimikos +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long +rocm amdgpu_target=gfx90a
  - umpire +rocm amdgpu_target=gfx90a
  - upcxx +rocm amdgpu_target=gfx90a
  # INCLUDED IN ECP DAV ROCM
  - paraview ~examples ~qt +rocm amdgpu_target=gfx90a ^llvm~lldb~lld~libomptarget~polly~gold libunwind=none compiler-rt=none # builds ok, installed w/ ecp-dav
  - vtk-m ~openmp +rocm amdgpu_target=gfx90a  # builds ok, installed w/ ecp-dav
  # --
  # - cp2k +mpi +rocm amdgpu_target=gfx90a    # cp2k-2025.1: https://github.com/spack/spack/issues/49544
  # - exago +mpi +python +raja +hiop +rocm amdgpu_target=gfx90a ~ipopt cxxflags="-Wno-error=non-pod-varargs" ^hiop@1.0.0 ~sparse +mpi +raja +rocm amdgpu_target=gfx90a # hiop-1.0.0: hiopVectorHip.hpp:68:10: fatal error: 'hipblas.h' file not found
  # - lbann ~cuda +rocm amdgpu_target=gfx90a  # aluminum-1.4.1: Could not find a configuration file for package "hip" that is compatible with requested version "5.0".
  # - magma ~cuda +rocm amdgpu_target=gfx90a  # magma-2.9.0: KeyError: 'No spec with name rocm-core in magma@2.9.0/sn7z3duxlwsf6u47ysy253vlsrrhauu4'
  # - papi +rocm amdgpu_target=gfx90a         # rocm-openmp-extras-6.2.1: Error: FileExistsError: [Errno 17] File exists: 


  - amrex +rocm amdgpu_target=gfx942
  - arborx +rocm amdgpu_target=gfx942
  - cabana +rocm amdgpu_target=gfx942 ^kokkos +rocm amdgpu_target=gfx942
  - caliper +rocm amdgpu_target=gfx942
  - chai tests=none +rocm amdgpu_target=gfx942
  - chapel +rocm amdgpu_target=gfx942
  - fftx +rocm amdgpu_target=gfx942
  - gasnet +rocm amdgpu_target=gfx942
  - ginkgo +rocm amdgpu_target=gfx942
  - heffte +rocm amdgpu_target=gfx942
  - hpx +rocm amdgpu_target=gfx942
  - hypre +rocm amdgpu_target=gfx942
  - kokkos +rocm amdgpu_target=gfx942
  - legion +rocm amdgpu_target=gfx942
  - libceed +rocm amdgpu_target=gfx942
  - mfem +rocm amdgpu_target=gfx942
  - petsc +rocm amdgpu_target=gfx942
  - raja ~openmp +rocm amdgpu_target=gfx942
  - slate +rocm amdgpu_target=gfx942
  - slepc +rocm amdgpu_target=gfx942 ^petsc +rocm amdgpu_target=gfx942
  - strumpack ~slate +rocm amdgpu_target=gfx942
  - sundials +rocm amdgpu_target=gfx942
  - superlu-dist +rocm amdgpu_target=gfx942
  - tasmanian ~openmp +rocm amdgpu_target=gfx942
  - trilinos +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext +ifpack ~ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu ~stokhos +stratimikos +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long +rocm amdgpu_target=gfx942
  - umpire +rocm amdgpu_target=gfx942
  - upcxx +rocm amdgpu_target=gfx942
  # INCLUDED IN ECP DAV ROCM
  - paraview ~examples ~qt +rocm amdgpu_target=gfx942 ^llvm~lldb~lld~libomptarget~polly~gold libunwind=none compiler-rt=none # kokkos-3.7.01: CMake Error at cmake/kokkos_arch.cmake:582 (MESSAGE): HIP enabled but no AMD GPU architecture currently enabled.  Please enable one AMD GPU architecture via -DKokkos_ARCH_{..}=ON'.
  - vtk-m ~openmp +rocm amdgpu_target=gfx942
  # --
  # - cp2k +mpi +rocm amdgpu_target=gfx942      # cp2k-2025.1: https://github.com/spack/spack/issues/49544
  # - exago +mpi +python +raja +hiop +rocm amdgpu_target=gfx942 ~ipopt cxxflags="-Wno-error=non-pod-varargs" ^hiop@1.0.0 ~sparse +mpi +raja +rocm amdgpu_target=gfx942 # magma-2.9.0: KeyError: 'No spec with name rocm-core in magma@2.9.0/sn7z3duxlwsf6u47ysy253vlsrrhauu4'
  # - lbann ~cuda +rocm amdgpu_target=gfx942    # aluminum-1.4.1: CMake Error at CMakeLists.txt:371 (find_package): Could not find a configuration file for package "hip" that is compatible with requested version "5.0". The following configuration files were considered but not accepted: /opt/rocm-6.3.3/lib/cmake/hip/hip-config.cmake, version: 6.3.42134
  # - magma ~cuda +rocm amdgpu_target=gfx942    # magma-2.9.0: KeyError: 'No spec with name rocm-core in magma@2.9.0/sn7z3duxlwsf6u47ysy253vlsrrhauu4'
  # - papi +rocm amdgpu_target=gfx942           # KeyError: 'No spec with name llvm-amdgpu in rocm-openmp-extras@6.3.2/wayw52vn3hid3zl2wqjt5ybumcqm45fp'
  